<header class="site-header" role="banner">
  <div class="wrapper">
    {%- assign default_paths = site.pages | map: "path" -%}
    {%- assign page_paths = site.header_pages | default: default_paths -%}
    
    <div class="header-content">
      
      <!-- Logo -->
      <div class="header-brand">
        <a href="{{ "/" | relative_url }}" class="header-brand-link">
          <img src="{{ "/assets/img/budsy-app-icon.png" | relative_url }}" alt="budsyapp" class="header-logo">
        </a>
      </div>

      <!-- Desktop Navigation with Theme Toggle -->
      {%- if page_paths -%}
      <nav class="site-nav desktop-nav">
        <div class="nav-links">
          {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: "path", path | first -%}
            {%- if my_page.title -%}
            <a class="page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a>
            {%- endif -%}
          {%- endfor -%}
          
          <!-- Theme Toggle Button -->
          <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">
            <span id="theme-icon">🌙</span>
          </button>
        </div>
      </nav>

      <!-- Mobile Navigation with Theme Toggle -->
      <nav class="site-nav mobile-nav">
        <div class="mobile-nav-controls">
          <!-- Mobile Theme Toggle -->
          <button id="theme-toggle-mobile" class="theme-toggle mobile-theme-toggle" onclick="toggleTheme()">
            <span id="theme-icon-mobile">🌙</span>
          </button>
          
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger" class="nav-trigger-label">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="24px" height="18px" class="menu-icon-svg">
                <path d="m18,1.484c0,0.82-0.665,1.484-1.484,1.484h-15.032c-0.819,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.032c0.819,0,1.484,0.665,1.484,1.484z m0,5.125c0,0.82-0.665,1.484-1.484,1.484h-15.032c-0.819,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.032c0.819,0,1.484,0.665,1.484,1.484z m0,5.109c0,0.82-0.665,1.484-1.484,1.484h-15.032c-0.819,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.032c0.819,0,1.484,0.665,1.484,1.484z"/>
              </svg>
            </span>
          </label>
        </div>

        <div class="trigger">
          {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: "path", path | first -%}
            {%- if my_page.title -%}
            <a class="page-link mobile-page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </nav>
      {%- endif -%}
    </div>

    <!-- Launch Status -->
    <div class="launch-status">
      <span class="launch-status-text">🚀 Mississippi Unit Support Coming Soon! 🚀 </span>
    </div>
  </div>
</header>

<script>
function toggleTheme() {
  const body = document.body;
  const isDark = body.classList.toggle('dark-mode');
  
  // Update toggle button icons only (no text)
  const icons = document.querySelectorAll('#theme-icon, #theme-icon-mobile');
  
  icons.forEach(icon => {
    icon.textContent = isDark ? '☀️' : '🌙';
  });
  
  // Save preference
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  
  // Force cache flush and reload for CSS
  const timestamp = new Date().getTime();
  const links = document.querySelectorAll('link[rel="stylesheet"]');
  links.forEach(link => {
    const href = link.href.split('?')[0];
    link.href = href + '?v=' + timestamp;
  });
  
  // Force a reflow to ensure styles are applied
  document.body.offsetHeight;
  
  // Add a small delay and force another reflow if needed
  setTimeout(() => {
    document.body.offsetHeight;
  }, 100);
}

// Load saved theme on page load
document.addEventListener('DOMContentLoaded', function() {
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  
  if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
    document.body.classList.add('dark-mode');
    const icons = document.querySelectorAll('#theme-icon, #theme-icon-mobile');
    
    icons.forEach(icon => icon.textContent = '☀️');
  }
});
</script>